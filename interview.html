<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // Question 1
      // Promise
      class _Promise {
        constructor(executor) {
          if (typeof executor !== "function") {
            throw new Error(`Promise resolver ${executor} is not a function`);
          }
          setTimeout(() => {});
          executor(this.resolve, this.reject);
        }

        value = null;
        reason = null;
        status = "pending";

        fullCallback = [];
        rejectCallback = [];

        resolve = (value) => {
          this.status = "fulfilled";
          this.value = value;
          if (this.fullCallback.length) {
            this.fullCallback.forEach((fn) => fn(value));
          }
        };

        reject = (reason) => {
          this.status = "rejected";
          this.reason = reason;
          if (this.rejectCallback.length) {
            this.fullCallback.forEach((fn) => fn(reason));
          }
        };

        then = (onfull, onreject) => {
          return new Promise((resolve, reject) => {
            if (this.status === "fulfilled") {
              onfull(this.value);
            }

            if (this.status === "rejected") {
              onreject(this.reason);
            }

            if (this.status === "pending") {
              this.fullCallback.push((value) => onfull(value));
              this.rejectCallback.push((reason) => onreject(reason));
            }
          });
        };
      }
      _Promise.all = (parameters) => {
        return new Promise((resolve, reject) => {
          const arr = Array.from(parameters);
          const len = arr.length;
          const res = [];

          arr.forEach((p) => {
            Promise.resolve(p).then(
              (value) => {
                res.push(value);
                if (res.length === len) {
                  resolve(res);
                }
              },
              (reason) => reject(reason)
            );
          });
        });
      };

      const promise1 = new Promise((resolve) => {
        setTimeout(() => resolve(11), 1000);
      });
      const promise2 = new Promise((resolve) => {
        setTimeout(() => resolve(22), 1000);
      });

      const _promise = new _Promise((resolve, reject) => {
        resolve(1);
        console.log("_first running");
      }).then(
        (value) => {
          console.log(value);
        },
        (reason) => {
          console.log(reason);
        }
      );
      _Promise.all([promise1, promise2]).then((values) => {
        console.log("_promise.all", values);
      });

      const promise = new Promise((resolve, reject) => {
        resolve(1);
        console.log("_first running");
      }).then(
        (value) => {
          console.log(value);
        },
        (reason) => {
          console.log(reason);
        }
      );
      Promise.all([promise1, promise2]).then((values) => {
        console.log("_promise.all", values);
      });
    </script>

    <script>
      // Question 2
      // # 水仙花数是指一个三位数，它的每个位上的数字的3次幂之和等于它本身。判断一个数是否是水仙花数的方法如下12345:
      // 将给定的数拆分为各个位上的数字。
      // 计算每个位上数字的3次幂。
      // 将每个位上数字的3次幂相加。
      // 判断相加的结果是否等于原始数。
      // 请计算输出100 - 1000000 间的所有的水仙花数

      // 153
      // 153 => 1**3 + 5**3 + 3**3 = 153
      // 1 + 125 + 27 = 153
      function validateEqualOriginal(num) {
        if (num < 100 || num > 1000000) return;

        const str = String(num);
        const len = str.length;

        let res = 0;
        for (let i = 0; i < str.length; i++) {
          const cur = Number(str[i]) ** len;
          res = res + cur;
        }

        if (res === num) return true;
        return false;
      }

      const res = validateEqualOriginal(153);
      console.log("res-validateEqualOriginal: ", res);

      const res2 = [];
      for (let i = 0; i < 1000; i++) {
        const num = i;

        if (num >= 100 && num <= 1000000) {
          const isTrue = validateEqualOriginal(num);
          if (isTrue) res2.push(num);
        }

        console.log("res2", res2);
      }

      console.log("res2", res2);
    </script>

    <script>
      // 过敏是感冒常见的症状
      // allergy is a common symptom of a cold.

      // 许多人对花粉过敏
      // Many people are allergic to pollen.

      // 你对花粉过敏吗？
      // are you allergic to pollen?

      // 花粉和灰尘是常见的过敏原
      // pollen and dust are common allergens.

      // -
      // 感冒一般伴有发烧和炎症
      //

      // 我的脚发炎了
      // My feet are inflamed.

      // -

      // 失眠症患者长期遭受失眠的困扰
      // insomniacs  suffer from insomnia for long time.

      // 长期熬夜会导致失眠
      // long-term staying up last can lead to insomnia.

      // -
      // 伤疤的地方既肿胀又痒
      // 

      // 康复后伤口变成了伤疤
      // 经济正在从衰退中缓慢复苏
      // 经过治疗，她的精神状态逐渐恢复了
      // -
      // 除了发烧，他还有恶心和呕吐的症状
      // -
      // 抗生素可以减轻发炎和肿胀的症状
      // 健康的饮食可以减少患病的概率
      // 复习可以增加找到工作的概率
      // -
      // 把表格填好后，交给护士
      // 填写存款单
      // 我预约了医生检查眼睛
      // 你没有提前预约吗？
      // -
      // 如果你对考试感到焦虑，你可以通过运动来减轻压力和缓解紧张
      // 我会开一些抗生素来帮你缓解疼
    </script>
  </body>
</html>
